# 패치 데이터 무결성 점검

## 개요

- **시작일**: 2026-01-10
- **상태**: 완료
- **관련 브랜치**: feature/34

## 목표

- [x] 패치노트에 명시된 실험체가 Firebase에 저장되어 있는지 점검
- [x] 누락된 패치 내역 목록 생성
- [ ] 누락된 데이터 수정 방안 제시

## 진행 상황

### 2026-01-10

- 프로젝트 구조 파악 완료
- 기존 스크립트 분석:
  - `validate-patch-data.ts`: 저장된 데이터와 크롤링 결과 비교 (변경사항 개수, 코멘트 확인)
  - `parse-balance-changes.ts`: 패치노트 파싱 및 Firebase 저장
- 새로운 점검 스크립트 `check-missing-patches.ts` 작성 완료
- 전체 126개 패치 점검 완료

## 점검 결과

**총 84개 누락 항목 발견** (33개 패치에 걸쳐 54명의 캐릭터)

### 가장 많이 누락된 패치

| 패치 ID | 버전        | 누락 수 | 누락 캐릭터                                                                                |
| ------- | ----------- | ------- | ------------------------------------------------------------------------------------------ |
| 1920    | 1.22        | 12명    | 매그너스, 얀, 에이든, 요한, 윌리엄, 일레븐, 재키, 카밀로, 카티야, 케네스, 테오도르, 프리야 |
| 3085    | 9.0 Part.2  | 9명     | 나딘, 에이든, 요한, 이바, 이안, 제니, 케네스, 프리야, 헤이즈                               |
| 2364    | 1.36 Part.2 | 9명     | 니키, 리 다이린, 바냐, 셀린, 아델라, 얀, 엘레나, 윌리엄, 펠릭스                            |
| 1727    | 1.15 Part.1 | 7명     | 로지, 리오, 바바라, 아르다, 아이솔, 칼라, 클로에                                           |
| 1515    | 1.7         | 5명     | 나타폰, 데비&마를렌, 버니스, 이안, 혜진                                                    |

### 가장 많이 누락된 캐릭터

| 캐릭터    | 누락 패치 수 | 패치 ID들              |
| --------- | ------------ | ---------------------- |
| 이안      | 4개          | 3085, 2132, 1545, 1515 |
| 얀        | 4개          | 2364, 1920, 1673, 1447 |
| 윌리엄    | 3개          | 3000, 2364, 1920       |
| 펠릭스    | 3개          | 2916, 2885, 2364       |
| 리 다이린 | 3개          | 2828, 2585, 2364       |
| 버니스    | 3개          | 2828, 2132, 1515       |

### 사용자가 보고한 누락 확인

- 패치 1954 (레온, 다르코): 웹 33명 vs Firebase 34명 - **레온은 정상, 다르코도 1954에서는 정상**
- 패치 1967: **다르코, 아드리아나, 아이솔 누락 확인**
- 패치 1973: Firebase에 데이터 없음 (별도 확인 필요)
- 패치 1727 (다니): 다니엘은 정상, **7명 다른 캐릭터 누락 확인**

## 실행 스크립트

### 1단계: 전체 패치 점검 (모든 patchNotes와 characters 비교)

```bash
npx tsx scripts/check-missing-patches.ts
```

### 2단계: 특정 패치만 점검

```bash
npx tsx scripts/check-missing-patches.ts --patch=1954,1967,1973,1727
```

### 3단계: 결과 확인

```bash
cat data/missing-patches.json
```

## 관련 파일

- `scripts/check-missing-patches.ts` - 누락 패치 점검 스크립트
- `data/missing-patches.json` - 점검 결과 파일

## 2단계: 누락 데이터 수정

### 수정 스크립트 계획

**파일**: `scripts/fix-missing-patches.ts`

**동작 방식**:

1. `data/missing-patches.json`에서 누락된 항목 로드
2. 패치별로 그룹화하여 웹페이지 크롤링 최소화
3. 각 누락된 캐릭터의 패치 데이터 파싱 (기존 `parse-balance-changes.ts` 로직 재사용)
4. Firebase `characters` 컬렉션에 patchHistory 추가
5. 캐릭터별 통계(stats) 재계산
6. 결과 리포트 출력

**안전장치**:

- `--dry-run` 옵션: 실제 저장 없이 미리보기
- `--patch=1920` 옵션: 특정 패치만 수정
- `--character=이안` 옵션: 특정 캐릭터만 수정
- 수정 전 백업 기능

### 실행 스크립트

```bash
# 1. 미리보기 (저장 안함)
npx tsx scripts/fix-missing-patches.ts --dry-run

# 2. 특정 패치만 수정
npx tsx scripts/fix-missing-patches.ts --patch=1920

# 3. 전체 수정
npx tsx scripts/fix-missing-patches.ts
```

## 관련 파일

- `scripts/check-missing-patches.ts` - 누락 패치 점검 스크립트
- `scripts/fix-missing-patches.ts` - 누락 데이터 수정 스크립트
- `data/missing-patches.json` - 점검 결과 파일

## 수정 완료 내역

### 1단계: 수동 추가 (8개) - 완료

자동 파싱 실패로 수동 확인 후 추가한 항목:

| 패치 ID | 캐릭터     | 변경 내용                                | 분류  |
| ------- | ---------- | ---------------------------------------- | ----- |
| 1328    | 시셀라     | E, Q 이동불가 지역 진입 버그 수정        | mixed |
| 1515    | 이안       | P 거리 2.6→2.4m, E 최대스택시 Overcharge | buff  |
| 1633    | 현우       | 어퍼컷(D) 도그파이트(P) 2스택 부여 제거  | nerf  |
| 1698    | 타지아     | 발사체 위치 조정                         | mixed |
| 1967    | 아드리아나 | 스킬 증폭 4.4%→4.1%                      | nerf  |
| 1967    | 아이솔     | 기본 공격력 41→38, 증폭 1.7%→1.6%        | nerf  |
| 1983    | 다르코     | Q 이동속도 버그, R 버그 수정             | mixed |
| 2450    | 아이작     | E 스킬 전환 개선                         | buff  |

**제외된 항목:**

- 패치 1447 얀: 장갑 무기 공격력 상향 (캐릭터 직접 변경 아님)
- 패치 3085 에이든: 애니메이션 개선만 (비주얼)

### 2단계: 자동 파싱 추가 (74개) - 완료

50명 캐릭터에 74개 패치 데이터 추가 완료.

## 최종 결과

| 구분                        | 개수     |
| --------------------------- | -------- |
| 수동 추가                   | 8개      |
| 자동 파싱 추가              | 74개     |
| **총 추가**                 | **82개** |
| 제외 (게임플레이 변경 없음) | 2개      |

**제외된 항목:**

- 패치 1447 얀: 장갑 무기 공격력 상향 (캐릭터 직접 변경 아님)
- 패치 3085 에이든: 애니메이션 개선만 (비주얼)

## 중단 시 이어서 할 작업

- [x] 점검 스크립트 작성 및 실행 완료
- [x] 수동 추가 8개 완료
- [x] 자동 파싱 74개 추가 완료
- [x] 최종 검증 완료
