# 연속 버프/너프 재계산 기능

## 개요

- **시작일**: 2026-01-09
- **상태**: 완료
- **관련 브랜치**: feature/29

## 목표

- [x] 캐릭터 상세 페이지에 연속(streak) 재계산 버튼 추가
- [x] 개별 캐릭터의 streak 재계산 API 구현
- [x] 빌드 테스트 통과
- [x] 중복 패치 데이터 검사 및 수정

## 배경

크롤링 과정에서 연속 버프/너프(streak) 여부가 정확하지 않게 계산된 실험체들이 있음.
이를 해결하기 위해 관리자가 개별 캐릭터의 streak을 재계산할 수 있는 기능 필요.

## 진행 상황

### 2026-01-09

- 기존 코드 구조 분석 완료
- 개별 캐릭터 재계산 API 구현: `/api/admin/characters/[name]/recalculate-streaks`
- 캐릭터 상세 페이지(`AdminPatchList.tsx`)에 "연속 재계산" 버튼 추가
- 빌드 테스트 통과
- 중복 패치 데이터 발견 및 수정
  - patchId 1654가 41개 캐릭터에서 2번씩 중복 저장됨
  - `scripts/find-duplicate-patches.ts`: 중복 검사 스크립트 작성
  - `scripts/fix-duplicate-patches.ts`: 중복 제거 스크립트 작성 및 실행
  - 총 41개 중복 엔트리 제거 완료

## 구현 내용

### API 엔드포인트

- **경로**: `POST /api/admin/characters/[name]/recalculate-streaks`
- **기능**: 해당 캐릭터의 streak 및 stats 재계산
- **인증**: Bearer token으로 관리자 권한 확인
- **응답**: 성공/실패 메시지 및 업데이트된 stats

### UI 버튼

- 캐릭터 상세 페이지(`/admin/character/[name]`)에 "연속 재계산" 버튼 추가
- 패치 목록 상단에 위치
- 진행 중 로딩 상태 표시
- 완료 시 페이지 새로고침으로 업데이트 반영
- 실패 시 에러 메시지 표시

## 관련 파일

- `src/app/api/admin/characters/[name]/recalculate-streaks/route.ts` (신규)
- `src/components/admin/AdminPatchList.tsx` (수정)
- `scripts/find-duplicate-patches.ts` (신규) - 중복 패치 검사
- `scripts/fix-duplicate-patches.ts` (신규) - 중복 패치 제거
