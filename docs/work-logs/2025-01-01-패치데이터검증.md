# 패치 데이터 검증 및 수정

## 개요

- **시작일**: 2025-01-01
- **상태**: 완료
- **관련 브랜치**: feature/15

## 목표

- [x] 스킬 헤더 파싱 로직 수정 (무기 스킬 패턴 지원)
- [x] 전체 패치 데이터 재파싱
- [x] devComment 버그 수정 (null 처리)
- [x] Firebase 데이터 업데이트

## 진행 상황

### 2025-01-01

#### 1. 문제 발견

- 313개 이슈 (280개 변경사항 불일치, 33개 코멘트 불일치)
- 스킬 타겟이 "기본 스탯"으로 잘못 분류됨
- 무기 스킬 패턴 (예: `쌍검 E`, `쌍날검 E`) 미지원

#### 2. parse-balance-changes.ts 수정

- 스킬 헤더 정규식 패턴 업데이트:

  ```javascript
  // 이전 (무기 스킬 미지원)
  /^([^→]+\([QWERP]\))/

  // 수정 (무기 스킬 지원)
  /^([^→]+\((?:[가-힣A-Za-z\s-]*)?[QWERP패시브]\d?\))/
  ```

#### 3. reparse-patches.ts 기능 추가

- `--all` 플래그: 전체 패치 재파싱
- `--force` 플래그: 무조건 덮어쓰기
- `getAllPatchIds()` 함수 추가

#### 4. apply-fixes.ts 버그 수정

- **버그**: `??` 연산자로 인해 null devComment가 기존 값으로 폴백

  ```typescript
  // 버그
  devComment: fix.newData.devComment ?? existingPatch.devComment;

  // 수정
  devComment: fix.newData.devComment;
  ```

#### 5. 결과

- 124개 패치, 2368개 수정사항, 84명 캐릭터 업데이트 완료
- devComment null 처리 정상 확인 (가넷 3042 등)

## 실행 스크립트

### 1단계: 전체 패치 재파싱 (patch-fixes.json 생성)

```bash
npx tsx scripts/reparse-patches.ts --all --force
```

### 2단계: Firebase에 수정사항 적용

```bash
npx tsx scripts/apply-fixes.ts
```

### (선택) Dry-run으로 확인만

```bash
npx tsx scripts/apply-fixes.ts --dry-run
```

### (선택) 특정 캐릭터만 적용

```bash
npx tsx scripts/apply-fixes.ts --character=가넷
```

## 관련 파일

- `scripts/parse-balance-changes.ts` - 메인 파싱 로직
- `scripts/reparse-patches.ts` - 재파싱 스크립트
- `scripts/apply-fixes.ts` - Firebase 적용 스크립트
- `data/patch-fixes.json` - 생성된 수정 데이터

## 배포 후 확인사항

- Vercel 재배포 또는 1시간 대기 (unstable_cache 만료)
- 로컬: `rm -rf .next && npm run dev`
